/**
 * @param {character[]} tasks
 * @param {number} n
 * @return {number}
 */
var leastInterval = function (tasks, n) {
  if (n === 0 || tasks.length < 2) {
    return tasks.length;
  }
  // 执行的顺序
  let debugSort = [];
  let time = 0;
  // 记录每种task的执行次数
  const taskMap = new Map();
  tasks.forEach((task) => {
    let count = 0;
    if (taskMap.has(task)) {
      count = taskMap.get(task);
    }
    count++;
    taskMap.set(task, count);
  });
  // 所有的任务都一样
  if (taskMap.size === 1) {
    return tasks.length * (n + 1) - n;
  }
  // 执照执行次数对task进行排序
  let taskQueue = [];
  for (const task of taskMap.entries()) {
    taskQueue.push(task);
  }
  taskQueue = sortTaskQueue(taskQueue);
  let taskIndex = 0;
  // 记录task开始执行的时间
  let taskStatus = new Map();
  while (taskQueue.length > 0) {
    const [task] = taskQueue[taskIndex];
    // 当前本次task的执行时间
    const prevTime =
      taskStatus.get(task) === undefined ? -1 : taskStatus.get(task);

    // 任务不满足执行条件
    if (prevTime !== -1 && time - prevTime <= n) {
      // 等待
      time++;
      debugSort.push('=');
    } else {
      // 任务执行
      taskStatus.set(task, time);
      time++;
      let count = taskMap.get(task);
      count--;
      debugSort.push('x-' + task);
      // 当前任务已经执行完了，那么将它从taskQueue中删除
      if (count === 0) {
        taskMap.delete(task);
        taskQueue = taskQueue.filter((t) => t[0] !== task);
        taskStatus.delete(task);
        hasDeleteTask = true;
      } else {
        taskMap.set(task, count);
        taskQueue[taskIndex][1] = count;
        // 重新对taskQueue进行排序
        taskQueue = sortTaskQueue(taskQueue);
      }
    }
    let nextTaskIndex = null;
    // 查找所有任务中满足条件的剩余执行次数最多的任务
    for (let index = 0; index < taskQueue.length; index++) {
      const pendingTask = taskQueue[index];
      const [task] = pendingTask;
      // 是等待任务，且满足执行条件
      if (taskStatus.has(task) && time - taskStatus.get(task) > n) {
        nextTaskIndex = index;
      } else if (nextTaskIndex === null && !taskStatus.has(task)) {
        // 第一个没有执行过的任务，直接跑出循环
        nextTaskIndex = index;
        break;
      }
    }
    // 说明没有找到满足条件的任务，taskIndex，下一次循环会进行等待
    if (nextTaskIndex === null) {
      taskIndex = 0;
    } else {
      taskIndex = nextTaskIndex;
    }
  }
  console.log(JSON.stringify(debugSort));
  return time;
};

function findTaskIndex(taskQueue, task) {
  return taskQueue.findIndex((t) => t[0] === task);
}

function sortTaskQueue(taskQueue) {
  return taskQueue.sort((a, b) => b[1] - a[1]);
}

// "A", "A", "A", "A", "A", "A", "B","B", "B", "C", "D", "E", "F", "G"
// 'A', 'A', 'A', 'B', 'B', 'B';
console.log(
  leastInterval(
    [
      'G',
      'C',
      'A',
      'H',
      'A',
      'G',
      'G',
      'F',
      'G',
      'J',
      'H',
      'C',
      'A',
      'G',
      'E',
      'A',
      'H',
      'E',
      'F',
      'D',
      'B',
      'D',
      'H',
      'H',
      'E',
      'G',
      'F',
      'B',
      'C',
      'G',
      'F',
      'H',
      'J',
      'F',
      'A',
      'C',
      'G',
      'D',
      'I',
      'J',
      'A',
      'G',
      'D',
      'F',
      'B',
      'F',
      'H',
      'I',
      'G',
      'J',
      'G',
      'H',
      'F',
      'E',
      'H',
      'J',
      'C',
      'E',
      'H',
      'F',
      'C',
      'E',
      'F',
      'H',
      'H',
      'I',
      'G',
      'A',
      'G',
      'D',
      'C',
      'B',
      'I',
      'D',
      'B',
      'C',
      'J',
      'I',
      'B',
      'G',
      'C',
      'H',
      'D',
      'I',
      'A',
      'B',
      'A',
      'J',
      'C',
      'E',
      'B',
      'F',
      'B',
      'J',
      'J',
      'D',
      'D',
      'H',
      'I',
      'I',
      'B',
      'A',
      'E',
      'H',
      'J',
      'J',
      'A',
      'J',
      'E',
      'H',
      'G',
      'B',
      'F',
      'C',
      'H',
      'C',
      'B',
      'J',
      'B',
      'A',
      'H',
      'B',
      'D',
      'I',
      'F',
      'A',
      'E',
      'J',
      'H',
      'C',
      'E',
      'G',
      'F',
      'G',
      'B',
      'G',
      'C',
      'G',
      'A',
      'H',
      'E',
      'F',
      'H',
      'F',
      'C',
      'G',
      'B',
      'I',
      'E',
      'B',
      'J',
      'D',
      'B',
      'B',
      'G',
      'C',
      'A',
      'J',
      'B',
      'J',
      'J',
      'F',
      'J',
      'C',
      'A',
      'G',
      'J',
      'E',
      'G',
      'J',
      'C',
      'D',
      'D',
      'A',
      'I',
      'A',
      'J',
      'F',
      'H',
      'J',
      'D',
      'D',
      'D',
      'C',
      'E',
      'D',
      'D',
      'F',
      'B',
      'A',
      'J',
      'D',
      'I',
      'H',
      'B',
      'A',
      'F',
      'E',
      'B',
      'J',
      'A',
      'H',
      'D',
      'E',
      'I',
      'B',
      'H',
      'C',
      'C',
      'C',
      'G',
      'C',
      'B',
      'E',
      'A',
      'G',
      'H',
      'H',
      'A',
      'I',
      'A',
      'B',
      'A',
      'D',
      'A',
      'I',
      'E',
      'C',
      'C',
      'D',
      'A',
      'B',
      'H',
      'D',
      'E',
      'C',
      'A',
      'H',
      'B',
      'I',
      'A',
      'B',
      'E',
      'H',
      'C',
      'B',
      'A',
      'D',
      'H',
      'E',
      'J',
      'B',
      'J',
      'A',
      'B',
      'G',
      'J',
      'J',
      'F',
      'F',
      'H',
      'I',
      'A',
      'H',
      'F',
      'C',
      'H',
      'D',
      'H',
      'C',
      'C',
      'E',
      'I',
      'G',
      'J',
      'H',
      'D',
      'E',
      'I',
      'J',
      'C',
      'C',
      'H',
      'J',
      'C',
      'G',
      'I',
      'E',
      'D',
      'E',
      'H',
      'J',
      'A',
      'H',
      'D',
      'A',
      'B',
      'F',
      'I',
      'F',
      'J',
      'J',
      'H',
      'D',
      'I',
      'C',
      'G',
      'J',
      'C',
      'C',
      'D',
      'B',
      'E',
      'B',
      'E',
      'B',
      'G',
      'B',
      'A',
      'C',
      'F',
      'E',
      'H',
      'B',
      'D',
      'C',
      'H',
      'F',
      'A',
      'I',
      'A',
      'E',
      'J',
      'F',
      'A',
      'E',
      'B',
      'I',
      'G',
      'H',
      'D',
      'B',
      'F',
      'D',
      'B',
      'I',
      'B',
      'E',
      'D',
      'I',
      'D',
      'F',
      'A',
      'E',
      'H',
      'B',
      'I',
      'G',
      'F',
      'D',
      'E',
      'B',
      'E',
      'C',
      'C',
      'C',
      'J',
      'J',
      'C',
      'H',
      'I',
      'B',
      'H',
      'F',
      'H',
      'F',
      'D',
      'J',
      'D',
      'D',
      'H',
      'H',
      'C',
      'D',
      'A',
      'J',
      'D',
      'F',
      'D',
      'G',
      'B',
      'I',
      'F',
      'J',
      'J',
      'C',
      'C',
      'I',
      'F',
      'G',
      'F',
      'C',
      'E',
      'G',
      'E',
      'F',
      'D',
      'A',
      'I',
      'I',
      'H',
      'G',
      'H',
      'H',
      'A',
      'J',
      'D',
      'J',
      'G',
      'F',
      'G',
      'E',
      'E',
      'A',
      'H',
      'B',
      'G',
      'A',
      'J',
      'J',
      'E',
      'I',
      'H',
      'A',
      'G',
      'E',
      'C',
      'D',
      'I',
      'B',
      'E',
      'A',
      'G',
      'A',
      'C',
      'E',
      'B',
      'J',
      'C',
      'B',
      'A',
      'D',
      'J',
      'E',
      'J',
      'I',
      'F',
      'F',
      'C',
      'B',
      'I',
      'H',
      'C',
      'F',
      'B',
      'C',
      'G',
      'D',
      'A',
      'A',
      'B',
      'F',
      'C',
      'D',
      'B',
      'I',
      'I',
      'H',
      'H',
      'J',
      'A',
      'F',
      'J',
      'F',
      'J',
      'F',
      'H',
      'G',
      'F',
      'D',
      'J',
      'G',
      'I',
      'E',
      'B',
      'C',
      'G',
      'I',
      'F',
      'F',
      'J',
      'H',
      'H',
      'G',
      'A',
      'A',
      'J',
      'C',
      'G',
      'F',
      'B',
      'A',
      'A',
      'E',
      'E',
      'A',
      'E',
      'I',
      'G',
      'F',
      'D',
      'B',
      'I',
      'F',
      'A',
      'B',
      'J',
      'F',
      'F',
      'J',
      'B',
      'F',
      'J',
      'F',
      'J',
      'F',
      'I',
      'E',
      'J',
      'H',
      'D',
      'G',
      'G',
      'D',
      'F',
      'G',
      'B',
      'J',
      'F',
      'J',
      'A',
      'J',
      'E',
      'G',
      'H',
      'I',
      'E',
      'G',
      'D',
      'I',
      'B',
      'D',
      'J',
      'A',
      'A',
      'G',
      'A',
      'I',
      'I',
      'A',
      'A',
      'I',
      'I',
      'H',
      'E',
      'C',
      'A',
      'G',
      'I',
      'F',
      'F',
      'C',
      'D',
      'J',
      'J',
      'I',
      'A',
      'A',
      'F',
      'C',
      'J',
      'G',
      'C',
      'C',
      'H',
      'E',
      'A',
      'H',
      'F',
      'B',
      'J',
      'G',
      'I',
      'A',
      'A',
      'H',
      'G',
      'B',
      'E',
      'G',
      'D',
      'I',
      'C',
      'G',
      'J',
      'C',
      'C',
      'I',
      'H',
      'B',
      'D',
      'J',
      'H',
      'B',
      'J',
      'H',
      'B',
      'F',
      'J',
      'E',
      'J',
      'A',
      'G',
      'H',
      'B',
      'E',
      'H',
      'B',
      'F',
      'F',
      'H',
      'E',
      'B',
      'E',
      'G',
      'H',
      'J',
      'G',
      'J',
      'B',
      'H',
      'C',
      'H',
      'A',
      'A',
      'B',
      'E',
      'I',
      'H',
      'B',
      'I',
      'D',
      'J',
      'J',
      'C',
      'D',
      'G',
      'I',
      'J',
      'G',
      'J',
      'D',
      'F',
      'J',
      'E',
      'F',
      'D',
      'E',
      'B',
      'D',
      'B',
      'C',
      'B',
      'B',
      'C',
      'C',
      'I',
      'F',
      'D',
      'E',
      'I',
      'G',
      'G',
      'I',
      'B',
      'H',
      'G',
      'J',
      'A',
      'A',
      'H',
      'I',
      'I',
      'H',
      'A',
      'I',
      'F',
      'C',
      'D',
      'A',
      'C',
      'G',
      'E',
      'G',
      'E',
      'E',
      'H',
      'D',
      'C',
      'G',
      'D',
      'I',
      'A',
      'G',
      'G',
      'D',
      'A',
      'H',
      'H',
      'I',
      'F',
      'E',
      'I',
      'A',
      'D',
      'H',
      'B',
      'B',
      'G',
      'I',
      'C',
      'G',
      'B',
      'I',
      'I',
      'D',
      'F',
      'F',
      'C',
      'C',
      'A',
      'I',
      'E',
      'A',
      'E',
      'J',
      'A',
      'H',
      'C',
      'D',
      'A',
      'C',
      'B',
      'G',
      'H',
      'G',
      'J',
      'G',
      'I',
      'H',
      'B',
      'A',
      'C',
      'H',
      'I',
      'D',
      'D',
      'C',
      'F',
      'G',
      'B',
      'H',
      'E',
      'B',
      'B',
      'H',
      'C',
      'B',
      'G',
      'G',
      'C',
      'F',
      'B',
      'E',
      'J',
      'B',
      'B',
      'I',
      'D',
      'H',
      'D',
      'I',
      'I',
      'A',
      'A',
      'H',
      'G',
      'F',
      'B',
      'J',
      'F',
      'D',
      'E',
      'G',
      'F',
      'A',
      'G',
      'G',
      'D',
      'A',
      'B',
      'B',
      'B',
      'J',
      'A',
      'F',
      'H',
      'H',
      'D',
      'C',
      'J',
      'I',
      'A',
      'H',
      'G',
      'C',
      'J',
      'I',
      'F',
      'J',
      'C',
      'A',
      'E',
      'C',
      'H',
      'J',
      'H',
      'H',
      'F',
      'G',
      'E',
      'A',
      'C',
      'F',
      'J',
      'H',
      'D',
      'G',
      'G',
      'D',
      'D',
      'C',
      'B',
      'H',
      'B',
      'C',
      'E',
      'F',
      'B',
      'D',
      'J',
      'H',
      'J',
      'J',
      'J',
      'A',
      'F',
      'F',
      'D',
      'E',
      'F',
      'C',
      'I',
      'B',
      'H',
      'H',
      'D',
      'E',
      'A',
      'I',
      'A',
      'B',
      'F',
      'G',
      'F',
      'F',
      'I',
      'E',
      'E',
      'G',
      'A',
      'I',
      'D',
      'F',
      'C',
      'H',
      'E',
      'C',
      'G',
      'H',
      'F',
      'F',
      'H',
      'J',
      'H',
      'G',
      'A',
      'E',
      'H',
      'B',
      'G',
      'G',
      'D',
      'D',
      'D',
      'F',
      'I',
      'A',
      'F',
      'F',
      'D',
      'E',
      'H',
      'J',
      'E',
      'D',
      'D',
      'A',
      'J',
      'F',
      'E',
      'E',
      'E',
      'F',
      'I',
      'D',
      'A',
      'F',
      'F',
      'J',
      'E',
      'I',
      'J',
      'D',
      'D',
      'G',
      'A',
      'C',
      'G',
      'G',
      'I',
      'E',
      'G',
      'E',
      'H',
      'E',
      'D',
      'E',
      'J',
      'B',
      'G',
      'I',
      'J',
      'C',
      'H',
      'C',
      'C',
      'A',
      'A',
      'B',
      'C',
      'G',
      'B',
      'D',
      'I',
      'D',
      'E',
      'H',
      'J',
      'J',
      'B',
      'F',
      'E',
      'J',
      'H',
      'H',
      'I',
      'G',
      'B',
      'D',
    ],
    1,
  ),
);

// a b c a b c d a b c d e
